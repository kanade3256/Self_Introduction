---
import { getCollection } from 'astro:content';
import Base from '../layouts/Base.astro';
import siteConfig from '../data/site.json';

// æ³¨ç›®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter(project => project.data.featured)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);
---

<Base title="ãƒ›ãƒ¼ãƒ " description={siteConfig.description}>
  <!-- Hero Section -->
  <section id="home" class="hero">
    <div class="container hero-inner">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="reveal">{siteConfig.hero.title}</h1>
          <p class="lead reveal">{siteConfig.hero.lead}</p>
          
          <div class="achievements reveal">
            {siteConfig.achievements.map((achievement) => (
              <div class={`achievement ${achievement.category}`}>
                <span class="achievement-icon">{achievement.icon}</span>
                <div class="achievement-content">
                  <h3 data-i18n={`index.achievements.${achievement.category}.title`}>{achievement.title}</h3>
                  <p data-i18n={`index.achievements.${achievement.category}.desc`}>{achievement.description}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        <div class="hero-visual reveal">
          <img src={siteConfig.hero.avatarImage} alt="Profile Avatar" class="avatar" width="200" height="200" />
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="section">
    <div class="container">
      <h2 class="section-title reveal" data-i18n="index.about.title">è‡ªå·±ç´¹ä»‹</h2>
      <div class="content-wrapper reveal">
        <HomeContent />
      </div>
    </div>
  </section>

  <!-- Skills Section -->
  {siteConfig.featureFlags.showSkills && (
    <section id="skills" class="section skills-section">
      <div class="container">
        <h2 class="section-title reveal" data-i18n="index.skills.title">æŠ€è¡“ã‚¹ã‚­ãƒ«</h2>
        
        {Object.entries(siteConfig.skills).map(([categoryKey, category]) => (
          <div class="skill-category reveal">
            <h3 class="skill-category-title">{category.title}</h3>
            <div class="skills-grid">
              {category.items.map((skill) => (
                <div class={`skill-item ${skill.category}`}>
                  <div class="skill-header">
                    <span class="skill-name">{skill.name}</span>
                    <span class="skill-level">{skill.level}%</span>
                  </div>
                  <div class="skill-bar">
                    <div class="skill-progress" style={`width: ${skill.level}%`}></div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </section>
  )}

  <!-- Projects Section -->
  {siteConfig.featureFlags.showProjects && (
    <section id="projects" class="section">
      <div class="container">
        <h2 class="section-title reveal" data-i18n="index.projects.title">ä¸»ãªåˆ¶ä½œç‰©</h2>
        
        <div class="projects-grid">
          {featuredProjects.map((project) => (
            <article class="card reveal">
              <div class="card-header">
                <div class={`card-icon ${project.data.category.includes('å®Ÿå‹™') ? 'business' : project.data.category.includes('ç ”ç©¶') ? 'research' : 'personal'}`}>
                  {project.data.category.includes('å®Ÿå‹™') ? 'ğŸ’¼' : project.data.category.includes('ç ”ç©¶') ? 'ğŸ”¬' : 'ğŸš€'}
                </div>
                <div class="card-title-group">
                  <h3>{project.data.title}</h3>
                  <span class="card-category">{project.data.category}</span>
                </div>
              </div>
              <p>{project.data.summary}</p>
              <ul class="meta">
                <li>å½¹å‰²: {project.data.role}</li>
                <li>æŠ€è¡“: {project.data.technologies.slice(0, 3).join(', ')}</li>
                <li>æˆæœ: {project.data.achievements[0]}</li>
              </ul>
              <div class="card-actions">
                {project.data.links?.demo && (
                  <a class="btn small" href={project.data.links.demo} target="_blank" rel="noopener noreferrer" aria-label="ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã‚’é–‹ã">ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ</a>
                )}
                {project.data.links?.repo && (
                  <a class="btn small" href={project.data.links.repo} target="_blank" rel="noopener noreferrer" aria-label="GitHubã‚’é–‹ã">GitHub</a>
                )}
                <a class="btn small" href={`/projects/${project.slug}`} aria-label="è©³ç´°ã‚’è¦‹ã‚‹">è©³ç´°ã‚’è¦‹ã‚‹</a>
              </div>
            </article>
          ))}
        </div>
        
        <div class="section-footer reveal">
          <a href="/projects" class="btn">ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã‚‹</a>
        </div>
      </div>
    </section>
  )}

  <!-- Contact Section -->
  {siteConfig.featureFlags.showContact && (
    <section id="contact" class="section contact-section">
      <div class="container">
        <h2 class="section-title reveal" data-i18n="index.contact.title">ãŠå•ã„åˆã‚ã›</h2>
        
        <div class="contact-wrapper reveal">
          <div class="contact-intro">
            <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„ãŠä»•äº‹ã®ã”ä¾é ¼ã€æŠ€è¡“çš„ãªã”è³ªå•ãªã©ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
          </div>
          
          <form class="message-form" aria-label="ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ">
            <div class="form-row">
              <div class="form-group">
                <label for="contact-name">ãŠåå‰ <span class="required">*</span></label>
                <input type="text" id="contact-name" name="name" required aria-describedby="name-error">
                <span class="error-message" id="name-error"></span>
              </div>
              <div class="form-group">
                <label for="contact-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="required">*</span></label>
                <input type="email" id="contact-email" name="email" required aria-describedby="email-error">
                <span class="error-message" id="email-error"></span>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="contact-company">çµ„ç¹”å</label>
                <input type="text" id="contact-company" name="company" placeholder="ä»»æ„">
              </div>
              <div class="form-group">
                <label for="contact-subject">ä»¶å <span class="required">*</span></label>
                <select id="contact-subject" name="subject" required aria-describedby="subject-error">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›¸è«‡">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›¸è«‡</option>
                  <option value="æŠ€è¡“çš„è³ªå•">æŠ€è¡“çš„è³ªå•</option>
                  <option value="è»¢è·ãƒ»æ¡ç”¨">è»¢è·ãƒ»æ¡ç”¨ã«ã¤ã„ã¦</option>
                  <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
                <span class="error-message" id="subject-error"></span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="contact-message">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ <span class="required">*</span></label>
              <textarea id="contact-message" name="message" rows="6" required aria-describedby="message-error" placeholder="ã”è³ªå•ã‚„ã”ç›¸è«‡å†…å®¹ã‚’ãŠèã‹ã›ãã ã•ã„"></textarea>
              <span class="error-message" id="message-error"></span>
            </div>
            
            <button type="submit" class="btn submit-btn">é€ä¿¡ã™ã‚‹</button>
          </form>
        </div>
      </div>
    </section>
  )}
</Base>