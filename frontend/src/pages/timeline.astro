---
import Base from '../layouts/Base.astro';
import { timelineData, timelineStats, ongoingFocus, groupTimelineByYear } from '../data/timeline.js';

// データをグループ化
const heroImageSrc = import.meta.env.PROD ? './assets/profile.jpg' : 
  (import.meta.env.BASE_URL ? (import.meta.env.BASE_URL + 'assets/profile.jpg').replace(/\/+/g, '/') : '/assets/profile.jpg');
const heroImageAlt = 'ポートフォリオ作成者のイメージ写真';
const timelineGroups = groupTimelineByYear(timelineData);
---

<Base title="タイムライン" description="学習・開発・研究・受賞・登壇などの歩みを時系列で紹介">
  <!-- Breadcrumb Navigation -->
  <nav class="breadcrumb-nav">
    <div class="layout-container">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
          <a href="./" class="breadcrumb-link" data-i18n="breadcrumb.home">ホーム</a>
        </li>
        <li class="breadcrumb-item breadcrumb-item--current" aria-current="page">
          <span class="breadcrumb-current">タイムライン</span>
        </li>
      </ol>
    </div>
  </nav>

  <section class="section section--hero timeline-hero">
    <div class="layout-container">
      <div class="timeline-hero__layout">
        <div class="timeline-hero__content">
          <header class="section__header">
            <p class="section__eyebrow" data-i18n="timeline.title">タイムライン・実績</p>
            <h1 class="section__title">成果と成長の軌跡</h1>
            <p class="section__lead" data-i18n="timeline.summary">学習・開発・研究・受賞・登壇などの歩みを時系列で紹介します。継続的な成長と挑戦の軌跡をご覧ください。</p>
          </header>
          <div class="timeline-hero__stats">
            {timelineStats.map((stat) => (
              <div class="timeline-hero__stat">
                <span class="timeline-hero__stat-value">{stat.value}</span>
                <span class="timeline-hero__stat-label">{stat.label}</span>
              </div>
            ))}
          </div>
        </div>
        <figure class="timeline-hero__profile">
          <img src={heroImageSrc} alt={heroImageAlt} loading="lazy" decoding="async" width="800" height="450" />
        </figure>
      </div>
    </div>
  </section>

  <section class="section timeline-section">
    <div class="layout-container">
      {timelineGroups.map((group) => (
        <section class="timeline-group" aria-label={group.year + ' ' + group.subtitle}>
          <header class="timeline-group__header">
            <span class="timeline-group__year">{group.year}</span>
            <p class="timeline-group__subtitle">{group.subtitle}</p>
          </header>

          <div class="timeline-list timeline-list--desktop">
            <ol>
              {group.entries.map((entry) => (
                <li class="timeline-item" data-kind={entry.kind}>
                  <div class="timeline-item__marker" aria-hidden="true"></div>
                  <div class="timeline-item__body">
                    <div class="timeline-item__header">
                      <span class="timeline-item__period">{entry.period}</span>
                      <h3 class="timeline-item__title">{entry.title}</h3>
                    </div>
                    <p class="timeline-item__summary">{entry.summary}</p>
                    <ul class="timeline-item__bullets" role="list">
                      {entry.bullets.map((bullet) => (
                        <li role="listitem">{bullet}</li>
                      ))}
                    </ul>
                    <div class="timeline-item__tags">
                      {entry.tags.map((tag) => (
                        <span class="badge badge--soft">{tag}</span>
                      ))}
                    </div>
                  </div>
                </li>
              ))}
            </ol>
          </div>

          <div class="timeline-accordion timeline-accordion--mobile">
            {group.entries.map((entry) => (
              <details class="timeline-accordion__item" data-kind={entry.kind}>
                <summary>
                  <span class="timeline-accordion__period">{entry.period}</span>
                  <span class="timeline-accordion__title">{entry.title}</span>
                </summary>
                <div class="timeline-accordion__content">
                  <p>{entry.summary}</p>
                  <ul role="list">
                    {entry.bullets.map((bullet) => (
                      <li role="listitem">{bullet}</li>
                    ))}
                  </ul>
                  <div class="timeline-accordion__tags">
                    {entry.tags.map((tag) => (
                      <span class="badge badge--soft">{tag}</span>
                    ))}
                  </div>
                </div>
              </details>
            ))}
          </div>
        </section>
      ))}
    </div>
  </section>

  <section class="section section--layer timeline-ongoing">
    <div class="layout-container">
      <header class="section__header">
        <p class="section__eyebrow" data-i18n="timeline.ongoing.title">継続的な取り組み</p>
        <h2 class="section__title">Focus Now</h2>
      </header>
      <div class="timeline-ongoing__grid">
        {ongoingFocus.map((item) => (
          <article class="timeline-ongoing__item card">
            <h3 class="timeline-ongoing__title">{item.title}</h3>
            <p class="timeline-ongoing__description">{item.description}</p>
          </article>
        ))}
      </div>
    </div>
  </section>
</Base>
